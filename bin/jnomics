#!/usr/bin/env bash

# Jnomics command script.
# Author: Matthew Titmus

# First things first. Is Hadoop around, and can we find it?
if [ -z "$(which hadoop)" ]
then
	echo "Jnomics cannot find the Hadoop command. Please verify that Hadoop is installed and included in your command path." 1>&2
	exit 1
fi

JNOMICS_BIN=$(dirname "$0")
JNOMICS_BIN=$(cd "$JNOMICS_BIN"; pwd)

JNOMICS_ROOT=$(dirname "$JNOMICS_BIN")
JNOMICS_CONF=$JNOMICS_ROOT/conf

if [ -z "$JNOMICS_JAR" ]
then
	JNOMICS_JAR=$(find .. | grep '/jnomics-tools.*\.jar$' | tail -n 1)
fi

if [ -z "$JNOMICS_JAR" ]
then
	echo "Jnomics cannot find jnomics-tools.jar. Please set \$JNOMICS_JAR to indicate the jar path." 1>&2
	exit 1
else
	JNOMICS_JAR=$(readlink -f $JNOMICS_JAR)
fi

if [ ! -e $JNOMICS_JAR ]
then
	echo "Cannot find the Jnomics tools jar (JNOMICS_JAR=$JNOMICS_JAR)." 1>&2
	exit 1
fi

# TODO Figure out a nice way to use the configurations in $JNOMICS_CONF/jnomics_conf.xml.

IFS=
HADOOP_CONF_DIR=$JNOMICS_CONF
for f in $JNOMICS_ROOT/jnomics-*.jar; do
	CLASSPATH=${CLASSPATH}:$f;
done

exec hadoop jar $JNOMICS_JAR $@

exit $?
